#!/bin/bash
# Morty - Simplified AI Development Loop
# Unified command interface

set -e

VERSION="0.1.0"
MORTY_HOME="${MORTY_HOME:-$HOME/.morty}"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

show_help() {
    cat << 'EOF'
Morty - Simplified AI Development Loop

Usage: morty <command> [options]

Commands:
    init <project>          Create new project from scratch
    import <prd.md> [name]  Import PRD and create project
    enable                  Enable Morty in existing project
    start                   Start the development loop
    monitor                 Start with tmux monitoring
    status                  Show current status
    version                 Show version

Examples:
    morty init my-project              # Create new project
    morty import requirements.md       # Import from PRD
    morty enable                       # Enable in current project
    morty start                        # Start loop
    morty monitor                      # Start with monitoring

EOF
}

show_version() {
    echo "Morty version $VERSION"
}

# Command routing
case "${1:-}" in
    init)
        shift
        exec "$MORTY_HOME/morty_init.sh" "$@"
        ;;
    import)
        shift
        exec "$MORTY_HOME/morty_import.sh" "$@"
        ;;
    enable)
        shift
        exec "$MORTY_HOME/morty_enable.sh" "$@"
        ;;
    start)
        shift
        exec "$MORTY_HOME/morty_loop.sh" "$@"
        ;;
    monitor)
        shift
        exec "$MORTY_HOME/morty_loop.sh" --monitor "$@"
        ;;
    status)
        shift
        exec "$MORTY_HOME/morty_loop.sh" --status "$@"
        ;;
    version|--version|-v)
        show_version
        ;;
    help|--help|-h|"")
        show_help
        ;;
    *)
        echo -e "${RED}Error: Unknown command '$1'${NC}"
        echo ""
        show_help
        exit 1
        ;;
esac
