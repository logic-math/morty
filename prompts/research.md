# Research

在满足`执行意图`的约束下不断执行`循环`中的工作步骤,结合用户的[输入]对[工作空间]与[搜索路径]进行学习并总结,直到满足`验证器`中的约束,才能结束循环,完成任务。

# 循环

loop:[验证器]
    step0: 理解用户[输入],根据这个输入理解这次 Research 的[调查主题]。

    step0.5: [探索工作空间] 如果工作空间是代码仓库且不熟悉结构，使用探索子代理：
           - 调用 `Task` 工具，subagent_type="Explore"
           - prompt: "Explore the codebase structure to understand: 1) project type 2) main directories 3) key configuration files 4) entry points 5) test structure"
           - thoroughness: "medium"
           - 等待探索结果，作为后续分析的基础

    step1: [定义搜索路径] 确定搜索路径,基于你的见解给出一些可信搜索源的建议;所谓[搜索路径]=[搜索源]+[搜索关键词];经用户确认后再开始搜索。

    step2: [搜索并记录] 根据确定的搜索路径,搜索相关资源,将搜索到的信息记录到`.morty/research/[调查主题].md`文件中。

    step3: [深入搜索工作空间] 搜索当前[工作空间]:
           1. 理解目录结构（可复用探索子代理的结果）
           2. 判断关键文件
           3. 读取关键文件内容
           4. 理解工作空间在做什么工作
           5. 如需深入了解特定模块，使用探索子代理
           6. 根据[工作空间]的工作类型执行具体的[执行意图]

    step4: [追问] 针对[调查主题]以及step[2-3]中得到的搜索信息,利用批判性思维不断的追问,这些信息以及用户输入在[价值],[事实],[逻辑]这三个维度的有效性,通过向用户提问的方式,让用户证明;

    step5: [综合理解] 根据你的理解,综合step[0-4]中得到的搜索信息,回答用户提出的问题,并总结对话内容更新到`.morty/research/[调查主题].md`文件中。

# 验证器

这是一个目录格式检查器
0. 如果 用户具有明确结束 Research  的意图, 则检查通过,结束循环。
1. 如果当前工作目录下不存在`.morty`目录,则检查不通过。
2. 如果`.morty`目录中不存在`research`目录,则检查不通过。
3. 如果`.morty/research`目录中不存在`[调查主题].md`文件,则检查不通过。
4. 其他情况下,结束循环.

# 执行意图

## 探索子代理使用规范

**触发条件**:
- 首次进入不熟悉的代码仓库
- 需要快速了解项目整体架构
- 需要定位特定功能的实现位置

**使用方法**:
```
Task工具参数:
- description: "探索代码库结构"
- prompt: "Explore the codebase to understand [具体目标]. Focus on: 1) project structure 2) key modules 3) configuration files"
- subagent_type: "Explore"
- thoroughness: "quick" | "medium" | "very thorough"
```

**探索结果应用**:
- 将探索结果的关键发现记录到 research 文件中
- 根据探索结果确定后续深入分析的方向
- 如需深入了解特定模块，可再次调用 Explore subagent

## 工作空间分析

1. 如果[工作空间]是一个[代码仓库],则探索这个[代码仓库],对[目录结构],[核心配置及参数],[部署方法],[测试方法],[初始化流程],[核心功能及处理流程],[核心数据结构],[状态机抽象]进行详细的分析与描述。

2. 如果[工作空间]是一个[文档仓库],则探索这个[文档仓库],对[目录结构]进行总结,对每个[文档]进行详细的分析与描述。

## 研究报告格式

研究报告应包含以下章节：

```markdown
# [调查主题] 调研报告

**调查主题**: [topic]
**调研日期**: [ISO8601]

---

## 1. 项目概述

### 1.1 项目类型
[代码仓库/文档仓库/混合]

### 1.2 目录结构
```
[树形结构]
```

### 1.3 技术栈
- [技术1]
- [技术2]

## 2. 核心发现

### 2.1 架构分析
...

### 2.2 关键代码
...

### 2.3 探索子代理发现（如使用）
- 发现1: ...
- 发现2: ...

## 3. 潜在问题

## 4. 改进建议

## 5. 相关资源

---

**文档版本**: 1.0
**研究完成时间**: [ISO8601]
**状态**: [已完成/进行中]
**探索子代理使用**: [是/否]
```
