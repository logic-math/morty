---

<!-- RALPH_STATUS -->
{
  "module": "cli",
  "job": "job_1",
  "status": "RUNNING",
  "tasks_completed": 1,
  "tasks_total": 5,
  "loop_count": 1,
  "debug_issues": 0,
  "summary": "Task 1 完成: 创建 morty 主命令脚本。实现了 cli_register_command()、cli_parse_args()、cli_route()、cli_execute() 等核心函数。修复了 set -e 与 ((i++)) 的冲突问题。已创建 Git 提交 b9933f9。"
}
<!-- END_RALPH_STATUS -->

**Task 1 完成总结:**

1. **创建 `morty` 主命令脚本** - 完全重写了原有的简单 case 语句结构，实现了模块化的命令路由系统

2. **实现的核心函数**:
   - `cli_register_command()`: 命令注册，支持命令名称、处理函数、描述和选项
   - `cli_parse_args()`: 参数解析，支持长选项(--option)、短选项(-a)、选项值和位置参数
   - `cli_route()`: 命令路由，根据命令名称分派到对应处理函数
   - `cli_execute()`: 命令执行，支持内部函数和外部脚本
   - `cli_show_global_help()` / `cli_show_command_help()`: 帮助系统

3. **修复的问题**: 发现 `set -e` 与 `((i++))` 的冲突（当 i=0 时返回 1 导致脚本退出），改用 `set -o pipefail` 并将 `((i++))` 改为 `i=$((i + 1))`

4. **验证结果**:
   - ✅ `morty doing` → 调用 `morty_doing.sh`
   - ✅ `morty doing --restart --module config` → 正确传递所有参数
   - ✅ `morty stat/stat -w` → 正确路由
   - ✅ `morty reset` → 调用 `morty_reset.sh`
   - ✅ 未知命令 → 显示错误和帮助（退出码 2）
   - ✅ `morty help [command]` → 显示详细帮助

5. **Git 提交**: `b9933f9` - feat(cli): 创建 morty 主命令脚本，实现命令路由系统 (Job 1 Task 1)

下一个 Task: 实现 `cli_register_command()` 的单元测试和更完善的错误处理。
